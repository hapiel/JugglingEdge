// 1111111112 2019-10-20
if(location.hash){document.getElementById(location.hash.substr(1)).className+=' SmallSelected'};if($('.SmallNew').length>0)$('h1').after('<p><a href="#" class="FirstNew">Go to first unread post</a></p>');$('a.FirstNew').click(function(e){var destination=$('.SmallNew:first').offset().top;$('html:not(:animated),body:not(:animated)').animate({scrollTop:destination},600);return false;});$('.SmallControls').append(' &#x2D; <a class="UnreadNav Prev" href="#">Previous unread</a> &#x2D; <a class="UnreadNav Next" href="#">Next unread</a>');ActivateButtons();function ActivateButtons(){var Posts=document.querySelectorAll('.SmallOP,.SmallReply'),b=Posts.length,Unread=document.getElementsByClassName('SmallNew'),Btn,FirstID=0,LastID=0;if(Unread.length>0)var FirstID=Unread[0].id,LastID=Unread[Unread.length-1].id;var ActivatePrev=0,ActivateNext=FirstID?1:0;for(a=0;a<b;++a){if(Posts[a].id===LastID)ActivateNext=0;Btn=Posts[a].getElementsByClassName('UnreadNav');if(Btn.length>0){Btn[0].className=ActivatePrev?'UnreadNav Prev':'UnreadNav Prev Inactive';Btn[1].className=ActivateNext?'UnreadNav Next':'UnreadNav Next Inactive';}if(Posts[a].id===FirstID)ActivatePrev=1;}}var e=document.querySelectorAll('.SmallReply:last-child .SmallControls'),b=e.length,ThreadID;for(a=0;a<b;++a){ThreadID=e[a].parentNode.parentNode.getAttribute('id').replace('Thread','');e[a].innerHTML+=' &dash; <a onclick="return MarkThreadAsRead('+ThreadID+');" href="/smallread.php?ThreadID='+ThreadID+'">Mark thread as read</a>';}$('a.UnreadNav').click(function(e){var Unread=document.getElementsByClassName('SmallNew'),b=Unread.length,a=0,ThisPost=this.parentNode.parentNode;if(this.className==='UnreadNav Next'){a=b;while(a>0 && ThisPost.offsetTop<Unread[a-1].offsetTop)--a;}else{a=-1;while(a<b-1 && ThisPost.offsetTop>Unread[a+1].offsetTop)++a;}if(Unread[a])$('html:not(:animated),body:not(:animated)').animate({scrollTop:Unread[a].offsetTop},600);return false;});function ToggleRead(SmallID){var e=$('#Small'+SmallID);if($(e).length>0){if($(e).attr('class').match(/SmallRead/,'')){var url='/smallread.php?MarkAsUnread='+SmallID;var LinkText='Mark as read';var RemoveClass='SmallRead';var AddClass='SmallNew';}else{var url='/smallread.php?MarkAsRead='+SmallID;var LinkText='Mark as unread';var RemoveClass='SmallNew';var AddClass='SmallRead';}$.get(url+'&Ajax=true',function(data){$('#SmallMarkAsRead'+SmallID).text(LinkText);$(e).removeClass(RemoveClass).addClass(AddClass);UpdateCounts(data);},'json').fail(function(){window.location=url;});}}function MarkThreadAsRead(ThreadID){var url='/smallread.php?Ajax=true&ThreadID='+ThreadID;$.get(url,function(data){var e=document.getElementById('Flag'+ThreadID);if(e)e.parentNode.removeChild(e);else{$('#Thread'+ThreadID+' .SmallNew').removeClass('SmallNew').addClass('SmallRead');$('#Thread'+ThreadID+' .MarkAsReadLink').text('Mark as unread');}UpdateCounts(data);},'json');return false;}$('.MarkAsReadLink').click(function(e){var SmallID=$(this).attr('id').replace('SmallMarkAsRead','');ToggleRead(SmallID);return false;});function UpdateCounts(data){var Flag=$('#SmallNotification');if(data.FlagText==0)$(Flag).hide();else{$(Flag).show();$(Flag).text(data.FlagText);$(Flag).attr('title',data.FlagTitle);}if(data.PostCnt==0)Str='';else{var LinkTxt=data.PostCnt===1?'1 unread post':data.PostCnt+' unread posts';var Str='<a href="/forum.php?View=Updated">'+LinkTxt+'</a>';if(data.DirectCnt>0){var LinkTxt=data.DirectCnt==1?'View 1 unread direct reply':'View '+data.DirectCnt+' unread direct replies';Str+='<br /><a href="/forum.php?View=DirectReplies">'+LinkTxt+'</a>';}Str+='<br /><a href="/marksmallread.php">Mark all as read</a>';}$('.UnreadPostControls').html(Str);var OnPageCnt=$('.SmallNew').length;if(OnPageCnt==0){$('#DirectRepliesText,#TopMarkThread,#BottomMarkThread').hide();}else{$('#DirectRepliesText').html('Mark all unread posts on this page ('+OnPageCnt+') as read');$('#DirectRepliesText,#TopMarkThread,#BottomMarkThread').show();}ActivateButtons();if(OnPageCnt===0 && data.PostCnt>0){var e=document.createElement('div');e.className='SmallNew SmallOP';e.style.position='fixed';e.style.bottom='10px';e.style.right='10px';e.style.padding='1em';e.innerHTML='<a href="/forum.php?View=Updated">There are more unread messages on the next page</a>';document.getElementById('usercontrols').appendChild(e);}}var e=document.getElementsByTagName('time'),a,b=e.length,ThisDate;for(a=0;a<b;++a){ThisDate=new Date(e[a].getAttribute('datetime'));e[a].innerHTML=Simplify(ThisDate);e[a].title=ThisDate.toString();}function Simplify(ThisDate){var t=ThisDate.toTimeString().substr(0,5),d=new Date();if(ThisDate.toDateString()==d.toDateString())return 'Today '+t;d.setDate(d.getDate()-1);if(ThisDate.toDateString()==d.toDateString())return 'Yesterday '+t;return ThisDate.toLocaleDateString()+' '+t;}$('div.SmallOP,div.SmallReply').dblclick(function(e){var SmallID=$(this).attr('id').replace('Small','');ToggleRead(SmallID);});$('a.FindParent').click(function(e){var ParentID=this.getAttribute('href');var Parent=$(this).parent().parent();var Prev=Parent.prev();if(Prev.hasClass('SmallGhost'))return false;if('#'+Prev.attr('id')==ParentID){e.preventDefault();var destination=$(Prev).offset().top;$('html:not(:animated),body:not(:animated)').animate({scrollTop:destination},400,function(){window.location.hash=ParentID;});}else{var Clone=$(ParentID).clone(true);Clone.addClass('SmallGhost');Clone.children('.SmallControls').remove();Clone.append('<p class="CloneWarning">This is a clone of the <a href="'+ParentID+'">original post</a> which is still up there &uarr; somewhere <a onclick="$(this).parent().parent().hide(400,function(){$(this).remove();});return false;" href="#">close</a><p>');Clone.hide();Parent.before(Clone);Clone.show(400);}return false;});$("a.ReplyLink,a.CreateNew").click(function(e){var ReturnTo=encodeURIComponent(document.location);var Token=document.getElementById('CsrfToken').getAttribute('data-Token');if(this.className==='CreateNew'){var Parent=this.parentNode,Indent=0,ParentID=0,ThreadID=0;}else{var Parent=this.parentNode.parentNode,Indent=Number(Parent.style.marginLeft.replace('px',''))+10,ParentID=Parent.getAttribute('id').replace('Small',''),ThreadID=Parent.parentNode.getAttribute('id').replace('Thread','');}var FormTxt='Full post form';var HelpTxt='Help';var CloseTxt='Close';var f=document.getElementById('InlineForm');if(f){if(f.ParentID.value==ParentID){$('#InlineForm p').toggle(300);$('#InlinePreview').hide(300);return false;}f.parentNode.removeChild(f);}Parent.insertAdjacentHTML('afterend','<form id="InlineForm" name="form" method="post" action="/smallpost.php" style="margin-left:'+Indent+'px"><input type="hidden" name="ActionTag" value="add" /><input type="hidden" name="SmallID" value="0" /><input type="hidden" name="ThreadID" value="'+ThreadID+'" /><input type="hidden" name="ParentID" value="'+ParentID+'" /><input type="hidden" name="Token" value="'+Token+'" /><input type="hidden" name="ReturnTo" value="'+ReturnTo+'" /><p style="display:none;" class="Meta"><a href="/smallpost.php?ParentID='+ParentID+'" onclick="if(document.form.Content.value!=\'\'){document.form.Preview.click();return false;}">'+FormTxt+'</a> &#x2D; <a href="/help/allowedhtml.php">'+HelpTxt+'</a> &#x2D; <a href="#" onclick="$(\'#InlineForm p,#InlinePreview\').hide(300);return false;">'+CloseTxt+'</a><br /><textarea name="Content" id="Content" rows="10" cols="60" required="required"></textarea></p><p style="display:none;" class="SmallPrint">By posting to the Juggling Edge you consent to committing your words to the public domain where anyone can read and reuse your content.</p><p style="display:none;"><input class="Button" type="button" value="Preview" onclick="InlinePreview();" style="min-width:6em" /> <input class="Button" type="submit" name="Post" value="Post" /> <input class="Button" type="submit" id="Preview" name="Preview" value="Preview" style="visibility:hidden"></p></form>');$('#InlineForm p').show(300);return false;});function InlinePreview(){var InlinePreview=document.getElementById('InlinePreview'),Form=document.getElementById('InlineForm'),str=document.getElementById('Content').value;if(InlinePreview){InlinePreview.parentNode.removeChild(InlinePreview);}$.ajax({type:'POST',url:'/smallpost.php',data:{Content:str,ActionTag:'InlinePreview'},success:function(data){Form.insertAdjacentHTML('beforebegin','<div id="InlinePreview" class="SmallReply SmallPreview" style="margin-left:'+Form.style.marginLeft+';display:none;">'+data+'</p></div>');if(typeof EmbedVids=='function'){EmbedVids(document.getElementById('InlinePreview').getElementsByClassName('LinkedVideo'));}if(typeof DrawCausals=='function'){DrawCausals(document.getElementById('InlinePreview').getElementsByClassName('CausalDiagram'));}if(typeof HighlightSS=='function'){HighlightSS(document.getElementById('InlinePreview').getElementsByClassName('SiteSwap'));}$('#InlinePreview').show(300);},dataType:'text'});}var ss=document.getElementsByClassName('SiteSwap'),a,b=ss.length,str,style;style=document.createElement('style');document.getElementsByTagName('head')[0].appendChild(style);style.type='text/css';style.sheet.insertRule('.SiteSwap{color:#090;cursor:pointer}',0);style.sheet.insertRule('.SiteSwap:hover{text-decoration:underline}',0);style.sheet.insertRule('#Anim{background-color:#fff;border:1px solid #ccc;width:420px;padding:10px;position:fixed;top:3em;left:50%;margin-left:-210px;text-align:center;}',0);for(a=0;a<b;++a){ss[a].addEventListener('click',ShowAnim);}function ShowAnim(evt){evt.preventDefault();var Pattern=evt.srcElement.innerText,d=document.getElementById('Anim');if(typeof animator!=='undefined'){animator.destroy();}if(!d){d=document.createElement('div');d.id='Anim';document.body.appendChild(d);}d.innerHTML='<span style="position:absolute;right:10px;font-size:2em;cursor:pointer;" onclick="animator.destroy();d=document.getElementById(\'Anim\');document.body.removeChild(d);return false;">&times;</span><canvas id="animator-canvas" width="240" height="360"></canvas><p><strong>'+Pattern+'</strong><br /></p>';animator=new SiteswapAnimator('animator-canvas',Pattern);}function SiteswapAnimator(CanvasID,Siteswap) {this.canvas=document.getElementById(CanvasID);this.ctx=this.canvas.getContext('2d');this.ctx.lineWidth=2;this.ctx.strokeStyle='#ccc';this.ctx.fillStyle='#ccc';this.paused=false;this.juggler=new Juggler(Siteswap.toLowerCase(),this.canvas.width,this.canvas.height);if(this.juggler.hands.valid){this.loop(this);}else{var x=this.canvas.width/2;var y=this.canvas.height/2;this.ctx.font='16px sans-serif';this.ctx.fillStyle='#000';this.ctx.textAlign='center';this.ctx.fillText('Invalid siteswap',x,y);}}SiteswapAnimator.prototype.destroy=function() {this.paused=true;this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);if(this.juggler) {for (var i=0; i<this.juggler.props.length; ++i) {delete this.juggler.props[i];}delete this.juggler.props;delete this.juggler.hands;delete this.juggler;}delete this;};SiteswapAnimator.prototype.loop=function(anim) {if (!anim.paused) {anim.juggler.update();anim.ctx.clearRect(0,0,anim.canvas.width,anim.canvas.height);anim.juggler.draw(anim.ctx);window.requestAnimationFrame(function() { anim.loop(anim); });}};function Juggler(ss,width,height) {this.hands=new Hands(ss,height);this.timeUnit=Math.round(60/3);this.width=width;this.height=height;var availableWidth=0.9*this.width,availableHeight=0.85*this.height;this.scale=Math.abs(availableHeight/(this.height/16*(2*this.hands.max-3)));if ((this.height*this.scale)/4>availableWidth) {this.scale=(4*availableWidth)/this.height;}var s=this.scale*this.height/16*(2*this.hands.max-3),t=0.5*this.hands.max*this.timeUnit;this.a=(2*s)/(t*t);this.props=new Props(this.timeUnit,this.a,this.scale,this.height);this.props.precalcThrows(this.hands);this.count=1;this.x=this.width/2;this.y=9*this.height/10;var h=this.scale*this.height/4;var w=h/2;this.body={};this.body.path=new Path2D();this.body.path.moveTo(-5*h/36,-33*h/40);this.body.path.bezierCurveTo(-5*h/36,-41*h/40,5*h/36,-41*h/40,5*h/36,-33*h/40);this.body.path.bezierCurveTo(5*h/36,-25*h/40,-5*h/36,-25*h/40,-5*h/36,-33*h/40);this.body.path.moveTo(-w/2,-5*h/8);this.body.path.lineTo(w/2,-5*h/8);this.body.path.lineTo(7*w/20,0);this.body.path.lineTo(-7*w/20,0);this.body.path.lineTo(-w/2,-5*h/8);this.body.shoulders={lx:-w/2,rx:w/2,y:-5*h/8};this.body.elbows={y:-h/7,offsetx:6*w/8};this.body.hands={offsety:-9*h/50};}Juggler.prototype.update=function() {this.hands.update(this.count,this.timeUnit,this.scale);this.props.update();if (this.count%this.timeUnit===0) {this.props.makeThrows();}++this.count;};Juggler.prototype.draw=function(ctx) {var  positions=this.hands.positions,body=this.body,lhx=0,lhy=0,rhx=0,rhy=0;ctx.save();ctx.translate(this.x,this.y);ctx.fill(body.path);ctx.beginPath();lhx=positions.left.x-body.elbows.offsetx;lhy=body.hands.offsety+positions.left.y;ctx.moveTo(body.shoulders.lx,body.shoulders.y);ctx.lineTo((-positions.left.x/8-body.elbows.offsetx),body.elbows.y);ctx.lineTo(lhx,lhy);rhx=positions.right.x+body.elbows.offsetx;rhy=body.hands.offsety+positions.right.y;ctx.moveTo(body.shoulders.rx,body.shoulders.y);ctx.lineTo((body.elbows.offsetx-positions.right.x/8),body.elbows.y);ctx.lineTo(rhx,rhy);ctx.stroke();var yOffset=9*this.scale*this.height/200;ctx.translate(0,-yOffset);ctx.beginPath();for (var i in this.props.props) {ctx.moveTo(this.props.props[i].x,this.props.props[i].y);ctx.arc(this.props.props[i].x,this.props.props[i].y,this.props.radius,0,this.props.pi2,false);}if (positions.left.y>=0 && this.props.holding[this.props.index].left) {lhy+=yOffset;ctx.moveTo(lhx,lhy);ctx.arc(lhx,lhy,this.props.radius,0,this.props.pi2,false);}if (positions.right.y>=0 && this.props.holding[this.props.index].right) {rhy+=yOffset;ctx.moveTo(rhx,rhy);ctx.arc(rhx,rhy,this.props.radius,0,this.props.pi2,false);}ctx.fillStyle='#f74';ctx.fill();ctx.restore();};function Hands(ss,height) {this.siteswap=ss.split('2t').join('2');this.left=[];this.right=[];this.xScoop=height/30;this.yScoop=height/40;this.type='';this.synch=false;this.max=0;this.valid=this.validateSiteswap();this.positions={left: {x: 0,y: 0},right: {x: 0,y: 0}};}Hands.prototype.update=function(count,timeUnit,scale) {count+=timeUnit;var i=count%(2*timeUnit),armAngle;if (i<(3*timeUnit/2)){armAngle=i/(3*timeUnit/2)*Math.PI;this.positions.left.x=this.xScoop*Math.cos(armAngle);this.positions.left.y=this.yScoop*-Math.sin(armAngle);}else{armAngle=count%(timeUnit/2)/(timeUnit/2)*Math.PI;this.positions.left.x=this.xScoop*-Math.cos(armAngle);this.positions.left.y=this.yScoop*Math.sin(armAngle);}this.positions.left.x*=scale;this.positions.left.y*=scale;if (this.synch){this.positions.right.y=this.positions.left.y;this.positions.right.x=-this.positions.left.x;}else{if (i<(timeUnit/2) || i>=timeUnit){armAngle=((count+timeUnit)%(2*timeUnit))/(3*timeUnit/2)*Math.PI;this.positions.right.x=this.xScoop*-Math.cos(armAngle);this.positions.right.y=this.yScoop*-Math.sin(armAngle);}else{armAngle=((count-timeUnit/2)%(2*timeUnit))/(timeUnit/2)*Math.PI;this.positions.right.x=this.xScoop*Math.cos(armAngle);this.positions.right.y=this.yScoop*Math.sin(armAngle);}this.positions.right.x*=scale;this.positions.right.y*=scale;}};Hands.prototype.validateSiteswap=function() {if (this.siteswap.match(/^[a-z\d]+$/)){this.type='vanilla';}else if (this.siteswap.match(/^([0-9a-z]*(\[[0-9a-z]{2,}\])+[0-9a-z]*)+$/)){this.type='multiplex';}else if (this.siteswap.match(/^(\([02468acegikmoqsuwy]x?,[02468acegikmoqsuwy]x?\))+\*?$/)){this.type='synchronous';this.synch=true;}else if (this.siteswap.match(/^(\(([02468acegikmoqsuwyx]x?|\[[02468acegikmoqsuwyx]{2,}\]),([02468acegikmoqsuwy]x?|\[[02468acegikmoqsuwyx]{2,}\])\))+\*?$/)){this.type='synchronous multiplex';this.synch=true;}else{return false;}if (this.siteswap.indexOf('*')>-1) {this.siteswap=this.siteswap.substring(0,this.siteswap.length-1);var working=this.siteswap,openingBrace,comma,closingBrace=working.indexOf(')');while (working.indexOf('(')>-1) {openingBrace=working.indexOf('(');comma=working.indexOf(',');closingBrace=working.indexOf(')');this.siteswap+='('+working.substring(comma+1,closingBrace)+','+working.substring(openingBrace+1,comma)+')';working=working.substring(closingBrace+1);}}if ((this.type==='vanilla' && this.siteswap.length%2===1) || (this.type==='multiplex' && this.siteswap.replace(/\[\w+\]/g,'1').length%2===1)) {this.siteswap+=this.siteswap;}var Hex='0123456789abcdefghijklmnopqrstuvwxyz';var Chars=[];var Values=[];var Beat=[];var Destination=[];var a=0;var b=this.siteswap.length;var ThisChar;var ThisValue;var ThisBeat=0;var SynchOffset=0;var InMultiplex=false;while(a<b){ThisChar=this.siteswap.charAt(a);ThisValue=Hex.indexOf(ThisChar);if(ThisValue!==-1){if (!this.left[ThisBeat]){this.left[ThisBeat]=[];this.right[ThisBeat]=[];}Chars[Chars.length]=ThisChar;Beat[Beat.length]=ThisBeat;if(this.synch && this.siteswap.charAt(a+1)==='x'){Values[Values.length]=ThisValue+SynchOffset;Chars[Chars.length-1]+='x';++a;}else{Values[Values.length]=ThisValue;}if(this.synch){if(this.siteswap.charAt(a)==='x'){ThisValue=-ThisValue;}if(SynchOffset===1){this.left[ThisBeat].push(ThisValue);}else{this.right[ThisBeat-1].push(ThisValue);this.left[ThisBeat].push(0);this.right[ThisBeat].push(0);}}else{if(ThisBeat%2===0){this.left[ThisBeat].push(ThisValue);this.right[ThisBeat].push(0);}else{this.left[ThisBeat].push(0);this.right[ThisBeat].push(ThisValue);}}if(InMultiplex===false){++ThisBeat;}}else{if(ThisChar==='('){SynchOffset=1;}if(ThisChar===','){SynchOffset=-1;}if(ThisChar==='['){InMultiplex=true;}if(ThisChar===']'){InMultiplex=false;++ThisBeat;}}++a;}var Period=ThisBeat;b=Values.length;for(a=0;a<b;++a){if(Values[a]===0){Destination[a]=Beat[a];}else{Destination[a]=(Beat[a]+Values[a])%Period;}}var In=[];var Out=[];b=Period;for(a=0;a<b;++a){In[a]=0;Out[a]=0;}b=Destination.length;for(a=0;a<b;++a){if(Values[a]!=0){++In[Destination[a]];++Out[Beat[a]];}}var arr=[].concat(...this.left).concat(...this.right);arr.sort(function (a,b) { return a-b; });this.max=Math.max(Math.abs(arr[0]),arr[arr.length-1]);if(In.toString()!==Out.toString()){return false;}return true;};function Props(timeUnit,a,scale,height) {this.radius=scale*height/80;this.pi2=2*Math.PI;this.timeUnit=timeUnit;this.a=a;this.w=3*height*scale/8;this.startx=3*this.w/20;this.index=0;this.props=[];}Props.prototype.precalcThrows=function(hands) {var a,b;this.init=[];this.holding=[];for (a in hands.left) {this.init[a]=[];this.holding[a]={ left:false,right:false};for (b in hands.left[a]) {if(hands.left[a][b]!==0) {this.init[a].push(new PropInitValues(hands.left[a][b],this.timeUnit,this.startx,0,this.w,this.a,'left'));this.holding[a].left=true;}}for (b in hands.right[a]) {if(hands.right[a][b]!==0) {this.init[a].push(new PropInitValues(hands.right[a][b],this.timeUnit,this.startx,0,this.w,this.a,'right'));this.holding[a].right=true;}}}};Props.prototype.update=function() {for (var i in this.props) {if (this.props[i].update(this.a)) {this.props.splice(i,1);}}};Props.prototype.makeThrows=function() {var throws=this.init[this.index],i,ii=throws.length;if (++this.index===this.init.length) {this.index=0;}for (i=0; i<ii; ++i) {this.props.push(new Prop(throws[i]));}};function PropInitValues(value,timeUnit,startx,starty,w,a,hand) {var cross=(value<0 || value%2===1);this.t=(Math.abs(value)-0.5)*timeUnit;this.startx=startx;this.starty=starty;this.vx=cross ? -w/2/this.t:w/5/this.t;this.vy=-a/2*this.t;if(hand==='left'){this.startx*=-1;this.vx *=-1;}}function Prop(init) {this.t=init.t ;this.x=init.startx;this.y=init.starty;this.vx=init.vx;this.vy=init.vy;}Prop.prototype.update=function(a) {this.x+=this.vx;this.vy+=a;this.y+=this.vy;return --this.t<1;};EmbedVids(document.getElementsByClassName('LinkedVideo'));function EmbedVids(v){var a,v,b=v.length,id,Filename,Text;for(a=0;a<b;++a){Text='';if(v[a].href.substr(0,17)==='https://youtu.be/'){id=v[a].href.substr(17);id+=(id.indexOf('?')===-1) ? '?':'&';Text='<span class="VideoBox1"><span class="VideoBox2" onclick="AddIframe(this,\'https://www.youtube.com/embed/'+id+'autoplay=1\');" style="background-image:url(https://i.ytimg.com/vi/'+id.replace(/\?.*/,'')+'/hqdefault.jpg)">Click to play</span></span>';}if(v[a].href.substr(0,18)==='https://vimeo.com/'){id=v[a].href.substr(18);Text='<span class="VideoBox1"><span class="VideoBox2"><iframe class="EmbeddedVideo" src="https://player.vimeo.com/video/'+id+'" allowfullscreen></iframe></span></span>';}if(v[a].href.substr(0,19)==='http://juggling.tv/'){id=v[a].getAttribute('href').replace('http://juggling.tv/','');Filename=decodeURIComponent(v[a].getAttribute('data-Filename'));Filename=Filename.replace(/\+/g,' ');Text='<span class="VideoBox1"><span class="VideoBox2"><video class="EmbeddedVideo" controls preload="metadata" poster="http://juggling.tv/thumb/l-0_'+id+'.jpg"><source src="http://juggling.tv/video/encoded/'+Filename+'" type="video/mp4" /></video></span></span>';}if(v[a].href.substr(0,22)==='https://instagram.com/'){Text='<div><iframe width="750" height="750" src="'+v[a].href+'embed/" allowfullscreen></iframe></div>';}v[a].insertAdjacentHTML('afterend',Text);}}function AddIframe(e,url){e.innerHTML='<iframe class="EmbeddedVideo" src="'+url+'" allowfullscreen></iframe>';}var abc='ABCDEFGHIJKLMNOPQRSTUVWXYZ';var Hex='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ';var DegToRad=Math.PI/180;var HorizSplit=60;var VertSplit=60;var FontSize=14;var NodeRadius=12;var LineWidth=1;var ArrowHead=8;var BackgroundColour='#ffffff';var NodeColour='#ffffff';var TextColour='#000000';var CauseColour='#999999';var HighlightColour='#ff0000';var BarColour='#cccccc';var Canvas=document.createElement('canvas');if(document.getElementsByClassName && Canvas.getContext && Canvas.getContext('2d')){var PixelRatio=window.devicePixelRatio || 1;DrawCausals(document.getElementsByClassName('CausalDiagram'));}function DrawCausals(e){for(var a=0;a<e.length;++a){Draw(e[a]);}}function Draw(Span){var Input=Span.innerHTML,Canvas=document.createElement('canvas'),Ctx=Canvas.getContext('2d'),Title='',Bars,Siteswap,ThisVal,PrechacThrow,W,H,Data,Meta,Hands=[],Delay=[],ThisAngle,Offset,a,b,c,x,y=VertSplit,MaxX=HorizSplit,x1,y1,x2,y2;Input=Input.replace(/(^&lt;|&gt;$)/g,'');Input=Input.replace(/\|/g,'\n');Input=Input.replace(/<br[\s\/]*>/g,'\n');Input=Input.replace(/<\/?\w[^>]*>/g,'');Input=Input.replace(/ +/g,' ');Input=Input.replace(/^\s+/g,'');Input=Input.replace(/\s+$/g,'');Input=Input.split(/[\n\r]+/);Span.innerHTML='';Span.appendChild(Canvas);a=0,b=Input.length;while(a<b){Input[a]=Input[a].trim();if(Input[a].match(/^Title\s*:\s*/i)){Title=Input[a].replace(/Title\s*:\s*/i,'');Input.splice(a,1);--b;}else if(Input[a].match(/^Bars?\s*:\s*/i)){Bars=Input[a].replace(/Bars?\s*:\s*/i,'');Input.splice(a,1);--b;}else++a;}if(Input.length===1 && Input[0].match(/^[\w,]+$/)){Siteswap=Input[0].toUpperCase();if(Title==='')Title=Siteswap.replace(/,/g,'');Siteswap=Siteswap+Siteswap;Input[0]='(RL 0)';Input[1]='(RL 0.5)';a=0;b=Siteswap.length;c=0;while(a<b){ThisVal=Hex.indexOf(Siteswap.charAt(a));PrechacThrow=ThisVal/2;if(ThisVal%2===1)PrechacThrow+='p';Input[c]+=' '+PrechacThrow;if(Siteswap[a+1]===','){Input[c]+=',';++a;}c=(c===0)?1:0;++a;}}for(a=0;a<Input.length;++a){Meta=Input[a].match(/\(.*\)/);if(Meta && Meta[0].match(/^\(\w+(\s[\.0-9]+)?\)$/i)){Meta=Meta[0].toString().replace(/(\(|\))/g,'').split(' ');Hands[a]=(Meta[0]) ? Meta[0]:'RL';Delay[a]=(Meta[1]) ? Meta[1]:0;}else{Hands[a]='RL';Delay[a]=0;}Input[a]=Input[a].replace(/\(.*\)\s/,'');Data=Input[a].split(' ');x=HorizSplit+(Delay[a]*HorizSplit);for(b=0;b<Data.length;++b){Xoffset=(Number(Data[b].replace(/[A-z,*]/g,''))-2)*HorizSplit;MaxX=Math.max(MaxX,x+Xoffset);x=x+HorizSplit;}}++MaxX;Canvas.width=MaxX+HorizSplit;Canvas.height=(Input.length+1)*(VertSplit+FontSize);if(PixelRatio>1){W=Canvas.width;H=Canvas.height;Canvas.width=W*PixelRatio;Canvas.height=H*PixelRatio;Canvas.style.width=W+'px';Canvas.style.height=H+'px';Ctx.scale(PixelRatio,PixelRatio);}Ctx.fillStyle=BackgroundColour;Ctx.fillRect(0,0,Canvas.width,Canvas.height);Ctx.font=FontSize+'px sans-serif';Ctx.lineWidth=LineWidth;Ctx.textAlign='center';Ctx.textBaseline='middle';if(Bars && Bars.length>0){Bars=Bars.replace(' ','');Bars=Bars.split(',');Ctx.strokeStyle=BarColour;y1=VertSplit/2;y2=(Input.length+0.5)*VertSplit;for(a=0;a<Bars.length;++a){x=Number(Bars[a])*HorizSplit;Ctx.beginPath();Ctx.moveTo(x,y1);Ctx.lineTo(x,y2);Ctx.stroke();}}for(a=0;a<Input.length;++a){Data=Input[a].split(' ');x=HorizSplit+(Delay[a]*HorizSplit);for(b=0;b<Data.length;++b){Ctx.strokeStyle=(Data[b].substr(-1)===',') ? HighlightColour:CauseColour;Data[b]=Data[b].replace(/[^\w\.]/g,'');Xoffset=(Number(Data[b].replace(/[A-z,]/g,''))-2)*HorizSplit;if(Data[b]==='3' && (!Data[b+1] || Data[b+1][0]!=='1')){DrawLine(Ctx,x,y,x+HorizSplit,y);}else if(Data[b]==='1'){DrawLine(Ctx,x,y,x-HorizSplit,y);}else if(Data[b].match(/[A-z]/)){Dest=Data[b].replace(/[0-9\.]/g,'').toUpperCase();if(Input.length==2 && Dest==='P'){Yoffset=(a===0) ? 1:-1;}else{Yoffset=abc.indexOf(Dest)-a;}Yoffset=Yoffset*VertSplit;DrawLine(Ctx,x,y,x+Xoffset,y+Yoffset);}else if(Data[b]!=='2'){x1=x;y1=y;x2=x+Xoffset;y2=y;PeakX=x+(Xoffset/2);PeakY=(Data[b]==='3' && (!Data[b+1] || Data[b+1][0]==='1')) ? y-(3*FontSize):y-(4*FontSize);ThisAngle=Math.atan2(y1-PeakY-180,x2-x1);Offset=NodeRadius*Math.cos(ThisAngle);x1=x1+Offset;x2=x2-Offset;Offset=NodeRadius*Math.sin(ThisAngle);y1=y1+Offset;y2=y2+Offset;Ctx.beginPath();Ctx.moveTo(x1,y1);Ctx.quadraticCurveTo(PeakX,PeakY,x2,y2);Ctx.stroke();ThisAngle=Math.atan2(y2-PeakY,x2-PeakX);DrawArrow(Ctx,x2,y2,ThisAngle);}x=x+HorizSplit;}Ctx.fillStyle=TextColour;Ctx.fillText(abc.charAt(a),HorizSplit/2,y);Ctx.strokeStyle=CauseColour;x=HorizSplit+(Delay[a]*HorizSplit);b=0;while(x<MaxX){Ctx.beginPath();Ctx.arc(x,y,NodeRadius,0,Math.PI*2,true);Ctx.closePath();Ctx.fillStyle=NodeColour;Ctx.fill();Ctx.stroke();Ctx.fillStyle=TextColour;Ctx.fillText(Hands[a].charAt(b%Hands[a].length),x,y);++b;x=x+HorizSplit;}y=y+VertSplit;}Ctx.textAlign='left';Ctx.fillStyle=TextColour;if(Title){x=(Canvas.width/PixelRatio-Ctx.measureText(Title).width)/2;Ctx.fillText(Title,x,y);}else{b=0;for(a=0;a<Input.length;++a)b=Math.max(b,Ctx.measureText(abc.charAt(a)+': '+Input[a]).width);x=(Canvas.width/PixelRatio-b)/2;for(a=0;a<Input.length;++a){Ctx.fillText(abc.charAt(a)+': '+Input[a],x,y);y=y+FontSize;}}}function DrawLine(Ctx,x1,y1,x2,y2){var ThisAngle=Math.atan2(y2-y1,x2-x1),Offset=NodeRadius*Math.cos(ThisAngle);x1=x1+Offset;x2=x2-Offset;Offset=NodeRadius*Math.sin(ThisAngle);y1=y1+Offset;y2=y2-Offset;Ctx.beginPath();Ctx.moveTo(x1,y1);Ctx.lineTo(x2,y2);Ctx.stroke();DrawArrow(Ctx,x2,y2,ThisAngle);}function DrawArrow(Ctx,x1,y1,ThisAngle){var a1=ThisAngle-Math.PI/6,a2=ThisAngle+Math.PI/6;Ctx.beginPath();Ctx.moveTo(x1-ArrowHead*Math.cos(a1),y1-ArrowHead*Math.sin(a1));Ctx.lineTo(x1,y1);Ctx.lineTo(x1-ArrowHead*Math.cos(a2),y1-ArrowHead*Math.sin(a2));Ctx.stroke();}$('.SmallControls').append(' &dash; <a class="SmallCollapse" href="#">Collapse this branch</a>');$('.SmallThread:not(:has(.SmallReply))').children('.SmallOP').children('.SmallControls').children('.SmallCollapse').replaceWith('<span class="Inactive">Collapse this branch</span>');$('div.NewBranch').prev('.SmallReply').children('.SmallControls').children('.SmallCollapse').addClass('SmallIsolate');$('div.SmallThread div.SmallReply:last-child').children('.SmallControls').children('.SmallCollapse').addClass('SmallIsolate');$('a.SmallIsolate').removeClass('SmallCollapse').text('Isolate this branch');$('a.SmallCollapse').click(function(e){var ThisLink=$(this);if(ThisLink.hasClass('Inactive'))return false;var Parent=ThisLink.parent().parent();var ParentLeft=Parent.offset().left;var Post=Parent.nextAll('.SmallReply');var ThisLeft=Post.offset().left;var ThisID,offset;var Txt1='Show this branch';var Txt2='Collapse this branch';var Txt=ThisLink.text()==Txt1?Txt2:Txt1;ThisLink.text(Txt);do{ThisID='#'+Post.attr('id');$(ThisID).children('*').not('[class="SmallHeader"]').toggle(500);Post=$(Post).nextAll('.SmallReply');offset=Post.offset();if(!offset)return false;}while(ThisLeft<offset.left);return false;});$('a.SmallIsolate').click(function(e){var ThisLink=$(this);var Parent=ThisLink.parent().parent();var ParentLeft=Parent.offset().left;if(ThisLink.text()=='Restore thread'){a=ThisLink.offset().top-$(window).scrollTop();ThisLink.text('Isolate this branch');Parent.parent().children().show();$(window).scrollTop(ThisLink.offset().top-a);}else{ThisLink.text('Restore thread');a=ThisLink.offset().top-$(window).scrollTop();Parent.nextAll().hide();Parent.prevAll().hide();do{Parent=$(Parent.children('.SmallControls').children('.FindParent').attr('href'));Parent.show();}while(!Parent.hasClass('SmallOP'))$(window).scrollTop(ThisLink.offset().top-a);}return false;});